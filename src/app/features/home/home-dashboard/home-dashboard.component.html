<p *ngIf="errorMessage.length != 0">{{ errorMessage }}</p>

<div *ngIf="(userLoginOn && !editMode) || !userLoginOn">
  <p> Correo: {{ usuario?.correo }}</p>
  <p> Nombre: {{ usuario?.nombre }}</p>
  <p> Apellido: {{ usuario?.apellido }}</p>
  <p> Rol: {{ usuario?.rol?.nombre }}</p>

  <button *ngIf="userLoginOn && !editMode" (click)="editMode=true"
          class="flex justify-center rounded-md bg-indigo-600 px-3 py-1.5 text-sm/6 font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600"
  >
    Editar Datos
  </button>
</div>

<form *ngIf="userLoginOn && editMode" [formGroup]="registerForm" (ngSubmit)="onSubmit()">

  <div class="flex flex-col gap-3">

    <div>
      <label for="nombre" class="block text-sm font-medium text-gray-900"> Nombre </label>
      <div class="mt-2">
        <input
          type="text"
          name="nombre"
          id="nombre"
          formControlName="nombre"
          autocomplete="name"
          required
          class="block w-full rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm/6"
          [ngClass]="{'outline-red-500': nombre.invalid && (nombre.dirty || nombre.touched)}"
        />
        <div *ngIf="nombre.invalid && (nombre.dirty || nombre.touched)" class="mt-1 text-sm text-red-600">
          <div *ngIf="nombre.hasError('required')">
            El nombre es requerido.
          </div>
        </div>
      </div>
    </div>

    <div>
      <label for="apellido" class="block text-sm/6 font-medium text-gray-900"> Apellido </label>
      <div class="mt-2">
        <input
          type="text"
          name="apellido"
          id="apellido"
          formControlName="apellido"
          autocomplete="lastname"
          required
          class="block w-full rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm/6"
          [ngClass]="{'outline-red-500': apellido.invalid && (apellido.dirty || apellido.touched)}"
        />
        <div *ngIf="apellido.invalid && (apellido.dirty || apellido.touched)" class="mt-1 text-sm text-red-600">
          <div *ngIf="apellido.hasError('required')">
            El apellido es requerido.
          </div>
        </div>
      </div>
    </div>

    <div>
      <label for="correo" class="block text-sm/6 font-medium text-gray-900"> Correo </label>
      <div class="mt-2">
        <input
          type="email"
          name="correo"
          id="correo"
          formControlName="correo"
          autocomplete="email"
          required
          class="block w-full rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm/6"
          [ngClass]="{'outline-red-500': correo.invalid && (correo.dirty || correo.touched)}"
        />
        <div *ngIf="correo.invalid && (correo.dirty || correo.touched)" class="mt-1 text-sm text-red-600">
          <div *ngIf="correo.hasError('required')">
            El correo es requerido.
          </div>
          <div *ngIf="correo.hasError('correo')">
            Ingresa un correo válido.
          </div>
        </div>
      </div>
    </div>

    <div>
      <label for="contrasena" class="block text-sm font-medium text-gray-900"> Contraseña </label>
      <div class="text-sm text-gray-600">
        Si dejas este campo vacío, la contraseña no se modificará.
      </div>

      <div class="mt-2">
        <input
          type="password"
          name="contrasena"
          id="contrasena"
          formControlName="contrasena"
          autocomplete="password"
          class="block w-full rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm/6"
          [ngClass]="{'outline-red-500': contrasena.invalid && contrasena.dirty}"
        />
        <div *ngIf="contrasena.invalid && contrasena.dirty" class="mt-1 text-sm text-red-600">
          <div *ngIf="contrasena.hasError('minlength')">
            La contraseña debe tener al menos 8 caracteres.
          </div>
        </div>
      </div>
    </div>

    <div>
      <label for="rol" class="block text-sm/6 font-medium text-gray-900"> Rol </label>
      <div class="mt-2">
        <select
          name="rol"
          id="rol"
          formControlName="rol"
          class="block w-full rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm/6"
        >
          <option *ngFor="let rol of roles" [value]="rol.id">{{ rol.nombre }}</option>
        </select>
        <div *ngIf="rol.invalid && (rol.dirty || rol.touched)" class="mt-1 text-sm text-red-600">
          <div *ngIf="rol.hasError('required')">
            El rol es requerido.
          </div>
        </div>
      </div>
    </div>

  </div>

  <div class="flex gap-2 mt-2">
    <button
      type="button"
      (click)="editMode=false"
      class="flex w-full justify-center rounded-md bg-indigo-600 px-3 py-1.5 text-sm/6 font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600"
    >
      Cancelar
    </button>

    <button
      type="submit"
      [disabled]="registerForm.invalid"
      class="flex w-full justify-center rounded-md bg-indigo-600 px-3 py-1.5 text-sm/6 font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600"
    >
      Guardar
    </button>
  </div>
</form>
